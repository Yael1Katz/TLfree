<!DOCTYPE HTML>
<html>

<head>
    <title>TLfree</title>
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="google-site-verification" content="T99vGHQ28rQ0ldK5hzggZH_Xb9H7MtvvQekwaGl4M2s" />

    <link href="https://rawgit.com/yael1katz/TLfree/master/css/style.css" rel="stylesheet" type="text/css" media="all" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://rawgit.com/yael1katz/TLfree/master/js/common-methods.js"></script>
    <script type="text/javascript" src="https://rawgit.com/yael1katz/TLfree/master/js/mootools-1.2.4-core.js"></script>
    <script type="text/javascript" src="https://rawgit.com/yael1katz/TLfree/master/js/mootools-1.2.4.2-more.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- Firebase App is always required and must be first -->
    <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-app.js"></script>

    <!-- Add additional services that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-database.js"></script>
    <link rel="shortcut icon" type="image/png" href="images/favicon.png" />

    <style>
        
    </style>
</head>

<body>
    <div class="header-top">
        <div class="wrap">
            <div class="center">
                <a href="index.html" class="logo1">
                    <img width="280px" height="120px" src="images/tlfree feature graphic.png" alt="" />
                </a>
            </div>
            <!--
            <div class="cssmenu">
                <nav id="nav" role="navigation">
                    <a href="#nav" title="Show navigation">Show navigation</a>
                    <a href="#" title="Hide navigation">Hide navigation</a>
                    <ul class="clearfix">
                        
                        <li class="active">
                            <a href="index.html">Home</a>
                        </li>
                        <li>
                            <a href="start.html">
                                <span>Get Started</span>
                            </a>
                        </li>
                        <li>
                            <a href="work.html">
                                <span>How it Works</span>
                            </a>
                        </li>
                        <li>
                            <a href="pricing.html">Pricing</a>
                        </li>
                        <li>
                            <a href="support.html">Support</a>
                        </li>
                        <div class="clear"></div>
                        
                    </ul>
                </nav>
            </div>
            -->
            <div class="buttons">
                <!--
                <div class="login_btn">
                    <a href="login.html">Login / Signup</a>
                </div>
                -->
                <!--
                <div class="get_btn">
                    <a href="start.html">Get Listed Today</a>
                </div>
                -->
                <div class="clear"></div>
            </div>
            <div class="clear"></div>
            <h2 class="head">Find the
                <span class="m_1">next event </span>You'll want
                <span class="m_1">to attend</span>
            </h2>
        </div>
    </div>
    <!--
    <div class="map">
        <img src="images/map.jpg" alt="" />
    </div>
    -->
    <div class="content-box">
        <div id="snackbar">
            <a href="#" class="closeGooglePlay" data-dismiss="alert" aria-label="close" onClick="googlePlayCloseButtonClicked(this)">&times;</a>
            <img width="140" src="images/getItOnGooglePlay.png" onclick="window.open('https://play.google.com/store/apps/details?id=com.omeric.android.tlfree', '_blank');googlePlayCloseButtonClicked(this);"
            />
        </div>
        <div class="wrap">
            <div class="panel-group" id="accordion">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                                Filters
                            </a>
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse">
                        <div class="panel-body">

                        </div>
                    </div>
                </div>
            </div>

            <div class="content-box-right">
                <div class="form-group row">
                    <div class="col-md-5">
                        <div class="btn-group">
                            <input id="searchinput" type="search" placeholder="Search..." class="form-control" onkeyup="filterChanged()">
                            <span id="searchclear" class="glyphicon glyphicon-remove-circle"></span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="row">
                            <div class="col-md-6">
                                <input class="form-control dateclass placeholderclass" id="calendar" placeholder="Select date..." type="date" onchange="filterChanged()"
                                    onClick="$(this).removeClass('placeholderclass')">
                            </div>

                            <div class="col-md-6">
                                <label>Sort:</label>
                                <select class="form-control" style="display: inline-block;width:auto;" onchange="sortChanged(this)">
                                    <option>Date</option>
                                    <option>Publish</option>
                                    <option>Distance</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="labelsGroup">
                            <label class="btn myBtn">
                                <img src="images/hq.png" class="img-thumbnail img-check imgCheckbox" id="chkHQ">
                            </label>
                            <label class="btn myBtn">
                                <img src="images/food.png" class="img-thumbnail img-check imgCheckbox" id="chkFood">
                            </label>
                            <label class="btn myBtn">
                                <img src="images/ic_90_percent_discount.png" class="img-thumbnail img-check imgCheckbox" id="chk90">
                            </label>
                            <label class="btn myBtn">
                                <img src="images/ic_editors_choice.png" class="img-thumbnail img-check imgCheckbox" id="chkEditorChoice">
                            </label>
                            <label class="btn myBtn">
                                <div class="img-thumbnail img-check imgCheckbox" id="chkAll" style="cursor: pointer;border-color: black;opacity: 1;">All</div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <ul class="events">
                <li class="active">
                    <a href="" onclick="eventsTab();return false;">Hot Events</a>
                </li>
                <li>
                    <a href="" onclick="favoritesTab();return false;">Favorites</a>
                </li>
                <li>
                    <a href="" onclick="mapTab();return false;">Map</a>
                </li>
            </ul>
            <div class="clear"></div>
        </div>
    </div>
    <div class="main">
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <iframe id="googleMapsWindow" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3380.409451336641!2d34.790327385453736!3d32.08521782624389!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x151d4b93b59302cb%3A0x5bfa6aa1e6d6a001!2z157XqdeUINep16jXqiA3LCDXqtecINeQ15HXmdeRINeZ16TXlQ!5e0!3m2!1siw!2sil!4v1528795489843"
                    width="100%" height="95%" frameborder="0" style="border:0" allowfullscreen></iframe>
            </div>
        </div>
        <div class="wrap">

        </div>
        <div class="footer">
            <div class="wrap">
                <div class="footer-bottom">
                    <!--
                <div class="copy">
                    <p>Â© 2014 Template by
                        <a href="http://w3layouts.com" target="_blank"> w3layouts</a>
                    </p>
                </div>
                -->
                    <div class="social">
                        <ul>
                            <li>
                                <a href="https://play.google.com/store/apps/details?id=com.omeric.android.tlfree" target="_blank">
                                    <img src="images/googleplay.png" />
                                </a>
                            </li>
                            <li>
                                <a href="https://www.instagram.com/tlfreenow/" target="_blank">
                                    <img src="images/instagram.png" />
                                </a>
                            </li>
                            <!--
                        <li class="facebook">
                            <a href="https://www.facebook.com/TLfree-196181621210411/">
                                <span> </span>
                            </a>
                        </li>
                        <li class="twitter">
                            <a href="#">
                                <span> </span>
                            </a>
                        </li>
                        <li class="linked">
                            <a href="#">
                                <span> </span>
                            </a>
                        </li>
                        <li class="arrow">
                            <a href="#">
                                <span> </span>
                            </a>
                        </li>
                        <li class="dot">
                            <a href="#">
                                <span> </span>
                            </a>
                        </li>
                        <li class="rss">
                            <a href="#">
                                <span> </span>
                            </a>
                        </li>
                        -->
                        </ul>
                    </div>
                    <div class="clear"></div>

                </div>
            </div>
        </div>
        <script>

            /*<div class="section group">
                <div class="col_1_of_3 span_1_of_3">
                    <div class="eventGUID">-LEJHlGcTJPCaWhc9vJ_</div>
                    <a href="https://www.meetup.com/full-stack-developer-il/events/248953340" target="_blank">
                        <img src="https://secure.meetupstatic.com/photos/event/e/9/4/5/highres_471539717.jpeg">
                    </a>
                    <ul class="m_fb">
                        <li>
                            <span class="m_23">
                                <i>
                                    <img width="30" src="images/food.png">
                                </i>
                            </span>
                            <span class="m_22 favorite">
                                <div class="star glyphicon glyphicon-star"></div>
                            </span>
                        </li>
                    </ul>
                    <div class="desc">
                        <h4 class="m_2">24-Jun-2018</h4>
                        <h3>
                            <a href="https://www.meetup.com/full-stack-developer-il/events/248953340" target="_blank">Developing a Webcam Arcade Controller using DL</a>
                        </h3>
                        <p>Are you a developer that is continually hearing about Deep Learning and wondering what all the fuss
                            is about?</p>
                        <p>1.3 km</p>
                    </div>
                    <div class="hr"></div>
                    <div class="section group center" style="padding: 0% 0% 2% 3%;">
                        <label class="btn myBtn popup" style="margin-right: 10px" onclick="openSharePopup(this.children[1])">
                            <img src="images/share.png" class="img-thumbnail" style="border:0;opacity: 0.5;">
                            <span class="popuptext">
                                <a href="https://twitter.com/intent/tweet?text=www.ynet.co.il" target="_blank" class="fa fa-twitter"></a>
                                <a href="https://www.facebook.com/sharer/sharer.php?u=www.ynet.co.il" target="_blank" class="fa fa-facebook"></a>
                                <a href="https://api.whatsapp.com/send?text=www.ynet.co.il" target="_blank" class="fa fa-whatsapp"></a>
                            </span>
                        </label>
                        <label class="btn myBtn" style="margin-right: 10px" onclick="showMap('!1m18!1m12!1m3!1d3380.9692511188787!2d34.79414459999999!3d32.0700804!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x151d4b9f0fb1749d%3A0x324efdf94c60554b!2z15nXkteQ15wg15DXnNeV158gOTgsINeq15wg15DXkdeZ15Eg15nXpNeV!5e0!3m2!1siw!2sil!4v1528958580653');return false;">
                            <img src="images/map.png" class="img-thumbnail" style="border:0;opacity: 0.5;">
                        </label>
                    </div>
                </div>
                <div class="clear"></div>
            </div>*/
            var mode = "desktop";
            var selectedSort = "Date";
            var foodFilterChecked;
            var hqFilterChecked;
            var filter90Checked;
            var editorChoiceFilterChecked;
            var allFilterChecked = true;
            var myCurrentLocation;
            var geocoder;
            var map;
            var markers = [];
            var timeouts = [];
            var service;
            var wrap = document.getElementsByClassName("wrap")[2];
            var modal = document.getElementById('myModal');
            var closeMapButton = document.getElementsByClassName("close")[0];
            var allEvents = [];
            var favoritesEventsGUIDs = [];
            var favoritesEvents = [];
            var filteredEvents = [];
            var mapDiv = document.createElement("div");
            mapDiv.setAttribute("id", "map");
            setDisplayMode();
            getAllEvents();
            var selectedTab = "eventsTab";
            function getAllEvents() {

                var config = {
                    apiKey: "AIzaSyDn2VWzzsZBK_q-VwEk0FksBW-z0MNE17Q",
                    authDomain: "tlfree-4b9bf.firebaseapp.com",
                    databaseURL: "https://tlfree-4b9bf.firebaseio.com",
                    projectId: "tlfree-4b9bf"
                };

                firebase.initializeApp(config);
                firebase.auth().signInAnonymously().catch(function (error) {
                    // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                });


            }
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in.
                    var ref = firebase.database().ref('db_tlfree');

                    ref.once("value", function (snapshot) {
                        var result = snapshot.val();
                        $.each(result, function (k, v) {
                            var date = Date.parse(v.full_date).toDateString();
                            date = getFormatedDate(date);
                            var currentDate = getFormatedDate(new Date().toDateString());
                            if (new Date(currentDate) - new Date(date) <= 0) {
                                var event = {
                                    guid: k, title: v.title, banner_uri: v.banner_uri,
                                    date: date, message_text: v.message_text, link_value: v.link_value,
                                    label: v.labels, labels: setLabels(v.labels), location: {
                                        distance: "", address: v.location.address,
                                        latitude: v.location.latitude, longtitude: v.location.longtitude
                                    }
                                };

                                allEvents.push(event);
                            }
                        });
                        sortEvents(allEvents);
                        initFavorites();
                        initFilteredEvents();
                        setCurrentLocation();
                    }, function (error) {
                        console.log("Error: " + error.code);
                    });

                } else {
                    // User is signed out.
                    // ...
                }
                // ...
            });
            function sortChanged(option) {
                selectedSort = $(option).find("option:selected").text();
                if (selectedSort == "Distance") {
                    sortEvents = sortEventByDistance;
                }
                else if (selectedSort == "Publish") {
                    sortEvents = sortEventByPublishDate;
                }
                else if (selectedSort == "Date") {
                    sortEvents = sortEventsByDate;
                }
                sortEvents(filteredEvents);
                if (selectedTab != "mapTab") {
                    createEvents(filteredEvents);
                }

            }
            var sortEvents = sortEventsByDate;
            function sortEventsByDate(events) {
                events.sort(function (a, b) {
                    return new Date(a.date).getTime() - new Date(b.date).getTime();
                });
            }
            function sortEventByPublishDate(events) {
                events.sort(function (a, b) { return (a.guid > b.guid) ? -1 : ((b.guid > a.guid) ? 1 : 0); });
            }
            function sortEventByDistance(events) {
                events.sort(function (a, b) {
                    var numA = isNaN(parseFloat(a.location.distance)) ? 1000 : parseFloat(a.location.distance);
                    var numB = isNaN(parseFloat(b.location.distance)) ? 1000 : parseFloat(b.location.distance);
                    return numA - numB;
                });
            }
            function setLabels(label) {
                var labels = [];
                if (label == 1) {
                    labels = [1];
                }
                else if (label == 2) {
                    labels = [2];
                }
                else if (label == 3) {
                    labels = [1, 2];
                }
                else if (label == 4) {
                    labels = [4];
                }
                else if (label == 8) {
                    labels = [8];
                }
                else if (label == 9) {
                    labels = [1, 8];
                }
                else if (label == 10) {
                    labels = [2, 8];
                }
                else if (label == 11) {
                    labels = [1, 2, 8];
                }
                return labels;
            }
            function getFormatedDate(date) {
                var month = date.toString().split(' ')[1];
                var dayNumber = date.toString().split(' ')[2];
                var year = date.toString().split(' ')[3];
                return dayNumber + "-" + month + "-" + year;
            }
            function filterChanged() {
                clearTimeouts();
                var iconFilterSelected = false;
                filteredEvents = [];
                var searchTerm = document.getElementById("searchinput").value.toUpperCase();
                var selectedDate = document.getElementById("calendar").value;

                var labels = [];
                if (foodFilterChecked) {
                    labels.push(1);
                    iconFilterSelected = true;
                }
                if (hqFilterChecked) {
                    labels.push(2);
                    iconFilterSelected = true;
                }
                if (filter90Checked) {
                    labels.push(4);
                    iconFilterSelected = true;
                }
                if (editorChoiceFilterChecked) {
                    labels.push(8);
                    iconFilterSelected = true;
                }
                if (allFilterChecked) {
                    iconFilterSelected = true;
                }
                if (selectedTab == "favoritesTab") {
                    addEventsToFilteredList(favoritesEvents, selectedDate, searchTerm, filteredEvents, labels, iconFilterSelected);
                }
                else {
                    addEventsToFilteredList(allEvents, selectedDate, searchTerm, filteredEvents, labels, iconFilterSelected);
                }

                sortEvents(filteredEvents);

                if (selectedTab == "mapTab") {
                    removeMarkers();
                    addMarkers();
                    document.getElementById("selectedPinEvent").innerHTML = "";
                }
                else {
                    createEvents(filteredEvents);
                }
            }
            function addEventsToFilteredList(events, selectedDate, searchTerm, filteredEvents, labels, iconFilterSelected) {
                events.forEach(event => {
                    if (iconFilterSelected) {
                        if (event.title.toUpperCase().indexOf(searchTerm) > -1
                            || event.message_text.toUpperCase().indexOf(searchTerm) > -1) {
                            if (labels.some(label => event.labels.includes(label)) || labels.length == 0) {
                                if (selectedDate != "") {
                                    selectedDate = new Date(selectedDate).toDateString();
                                    selectedDate = getFormatedDate(selectedDate);
                                    if (event.date == selectedDate) {
                                        filteredEvents.push(event);
                                    }
                                }
                                else {
                                    filteredEvents.push(event);
                                }
                            }
                        }
                    }
                });
            }
            function createEvents(events) {
                var itemsCounter = 0;
                wrap.innerHTML = "";
                var sectionGroup;
                events.forEach(event => {
                    if (itemsCounter % 3 == 0) {
                        sectionGroup = document.createElement("div");
                        sectionGroup.setAttribute("calss", "section group");
                        wrap.appendChild(sectionGroup);
                        clear = document.createElement("div");
                        clear.setAttribute("class", "clear");
                        wrap.appendChild(clear);
                    }
                    var eventCard = document.createElement("div");
                    eventCard.setAttribute("class", "col_1_of_3 span_1_of_3");
                    var div = document.createElement("div");
                    div.setAttribute("class", "eventGUID");
                    div.innerHTML = event.guid;
                    eventCard.appendChild(div);
                    var a = document.createElement("a");
                    a.href = event.link_value;
                    a.target = "_blank";
                    a.setAttribute("rel", "no-refresh");
                    var img = document.createElement("img");
                    img.src = event.banner_uri;
                    a.appendChild(img)
                    eventCard.appendChild(a);

                    if (event.label != 0) {
                        var ul = document.createElement("ul");
                        ul.setAttribute("class", "m_fb");
                        var li = document.createElement("li");

                        var span = document.createElement("span");
                        span.setAttribute("class", "m_23");
                        var i = document.createElement("i");
                        var img = document.createElement("img");
                        img.width = "30";
                        i.appendChild(img);
                        span.appendChild(i);
                        li.appendChild(span);
                        if (event.label == 1) {
                            img.src = "images/food.png";
                        }
                        else if (event.label == 2) {
                            img.src = "images/hq.png";
                        }
                        else if (event.label == 3) {
                            img.src = "images/hq.png";
                            li.appendChild(span);

                            span = document.createElement("span");
                            span.setAttribute("class", "m_23");
                            i = document.createElement("i");
                            img = document.createElement("img");
                            img.src = "images/food.png";
                            img.width = "30";
                            i.appendChild(img);
                            span.appendChild(i);
                            li.appendChild(span);
                        }
                        else if (event.label == 4) {
                            img.src = "images/ic_90_percent_discount.png";
                        }
                        else if (event.label == 10) {
                            img.src = "images/hq.png";
                            li.appendChild(span);

                            span = document.createElement("span");
                            span.setAttribute("class", "m_23");
                            i = document.createElement("i");
                            img = document.createElement("img");
                            img.src = "images/ic_editors_choice.png";
                            img.width = "30";
                            i.appendChild(img);
                            span.appendChild(i);
                            li.appendChild(span);
                        }
                        else if (event.label == 11) {
                            img.src = "images/hq.png";
                            li.appendChild(span);

                            span = document.createElement("span");
                            span.setAttribute("class", "m_23");
                            i = document.createElement("i");
                            img = document.createElement("img");
                            img.src = "images/food.png";
                            img.width = "30";
                            i.appendChild(img);
                            span.appendChild(i);
                            li.appendChild(span);

                            span = document.createElement("span");
                            span.setAttribute("class", "m_23");
                            i = document.createElement("i");
                            img = document.createElement("img");
                            img.src = "images/ic_editors_choice.png";
                            img.width = "30";
                            i.appendChild(img);
                            span.appendChild(i);
                            li.appendChild(span);
                        }


                        span = document.createElement("span");
                        span.setAttribute("class", "m_22 favorite");
                        var div = document.createElement("div");
                        if (favoritesEventsGUIDs.indexOf(event.guid) > -1) {
                            div.setAttribute("class", "star glyphicon glyphicon-star");
                        }
                        else {
                            div.setAttribute("class", "star glyphicon glyphicon-star-empty");
                        }
                        span.appendChild(div);
                        li.appendChild(span);
                        ul.appendChild(li);
                        eventCard.appendChild(ul);
                    }

                    var desc = document.createElement("div");
                    desc.setAttribute("class", "desc");
                    var h3 = document.createElement("h3");
                    a = document.createElement("a");
                    a.href = event.link_value;
                    a.target = "_blank";
                    a.innerHTML = event.title;
                    a.setAttribute("rel", "no-refresh");
                    var p = document.createElement("p");
                    p.innerHTML = event.message_text;
                    h3.appendChild(a);
                    var h4 = document.createElement("h4");
                    h4.setAttribute("class", "m_2");
                    h4.innerHTML = event.date;
                    desc.appendChild(h4);
                    desc.appendChild(h3);
                    desc.appendChild(p);
                    if (event.location.distance != "") {
                        p = p = document.createElement("p");
                        p.innerHTML = event.location.distance;
                        desc.appendChild(p);
                    }
                    eventCard.appendChild(desc);
                    var hr = document.createElement("hr");
                    hr.setAttribute("class", "hr");
                    eventCard.appendChild(hr);
                    div = document.createElement("div");
                    div.setAttribute("class", "section group center");
                    div.setAttribute("style", "padding: 0% 0% 2% 3%");

                    var label = document.createElement("label");
                    label.setAttribute("class", "btn myBtn popup");
                    label.setAttribute("style", "margin-right: 10px");
                    label.setAttribute("onclick", "openSharePopup(this.children[1])");
                    img = document.createElement("img");
                    img.src = "images/share.png";
                    img.setAttribute("class", "img-thumbnail");
                    img.setAttribute("style", "border:0;opacity: 0.5");
                    span = document.createElement("span");
                    span.setAttribute("class", "popuptext");
                    a = document.createElement("a");
                    a.setAttribute("class", "fa fa-twitter");
                    a.setAttribute("href", "https://twitter.com/intent/tweet?text=" + event.title + " : " + event.link_value);
                    a.setAttribute("target", "_blank");
                    a.setAttribute("rel", "no-refresh");
                    span.appendChild(a);
                    a = document.createElement("a");
                    a.setAttribute("class", "fa fa-facebook");
                    a.setAttribute("href", "https://www.facebook.com/sharer/sharer.php?u=" + event.link_value);
                    a.setAttribute("target", "_blank");
                    a.setAttribute("rel", "no-refresh");
                    span.appendChild(a);
                    a = document.createElement("a");
                    a.setAttribute("class", "fa fa-whatsapp");
                    a.setAttribute("href", "https://api.whatsapp.com/send?text=" + event.link_value);
                    a.setAttribute("target", "_blank");
                    a.setAttribute("rel", "no-refresh");
                    span.appendChild(a);
                    label.appendChild(img);
                    label.appendChild(span);
                    div.appendChild(label);
                    if (event.location.address != "") {
                        label = document.createElement("label");
                        label.setAttribute("class", "btn myBtn");
                        label.setAttribute("style", "margin-right: 10px");
                        label.setAttribute("onclick", "showMap('" + event.location.address + "');return false;");
                        label.setAttribute("title", event.location.address);
                        img = document.createElement("img");
                        img.src = "images/map.png";
                        img.setAttribute("class", "img-thumbnail");
                        img.setAttribute("style", "border:0;opacity: 0.5;");
                        label.appendChild(img);
                        div.appendChild(label);
                    }
                    eventCard.appendChild(div);
                    sectionGroup.appendChild(eventCard);
                    itemsCounter++;
                });

                favoriteClicked();


            }
            function favoriteClicked() {
                $(".star.glyphicon").click(function () {
                    var eventGUID = $(this).parent().parent().parent().parent().children()[0].innerHTML;
                    //add to favorite
                    if ($(this)[0].getAttribute("class") == "star glyphicon glyphicon-star-empty") {
                        favoritesEventsGUIDs.push(eventGUID);
                    }
                    //remove from favorites
                    else {
                        var index = favoritesEventsGUIDs.indexOf(eventGUID);
                        if (index > -1) {
                            favoritesEventsGUIDs.splice(index, 1);
                        }
                    }
                    localStorage.setItem("favorites", JSON.stringify(favoritesEventsGUIDs));
                    $(this).toggleClass("glyphicon-star glyphicon-star-empty");

                });
            }
            function initFavorites() {
                var favorites = localStorage.getItem("favorites");
                if (favorites != null) {
                    favorites = JSON.parse(favorites);
                    allEvents.forEach(event => {
                        if (favorites.indexOf(event.guid) > -1) {
                            favoritesEventsGUIDs.push(event.guid);
                        }
                    });
                }
            }
            function initFilteredEvents() {
                allEvents.forEach(event => {
                    filteredEvents.push(event);

                });
            }
            function favoritesTab() {
                selectedTab = "favoritesTab";
                favoritesEvents = [];

                allEvents.forEach(event => {
                    if (favoritesEventsGUIDs.indexOf(event.guid) > -1) {
                        favoritesEvents.push(event);
                    }
                });
                filterChanged();
                createEvents(filteredEvents);
            }
            function eventsTab() {
                selectedTab = "eventsTab";
                filterChanged();
                createEvents(filteredEvents);
            }
            function mapTab() {
                selectedTab = "mapTab";

                wrap.innerHTML = "";
                var raw = document.createElement("div");
                raw.setAttribute("class", "raw");
                var div = document.createElement("div");
                div.setAttribute("class", "col-sm-8");
                div.style.height = "600px";
                raw.appendChild(div);
                div.appendChild(mapDiv);
                div = document.createElement("div");
                div.setAttribute("class", "col-sm-4");
                div.setAttribute("id", "selectedPinEvent");
                raw.appendChild(div);
                div = document.createElement("div");
                div.setAttribute("class", "clear");
                raw.appendChild(div);
                wrap.appendChild(raw);

                filterChanged();
            }
            function clearFilters() {
                $("#searchinput").val('');
                document.getElementById("calendar").value = "";
            }
            function showMap(address) {
                var src = "https://www.google.com/maps/embed/v1/place?key=AIzaSyDdZD0Rsf1mCKYSh1Xu9I1d3uNIZM2hNEo&q=" + address;
                var googleMapsWindow = document.getElementById("googleMapsWindow");
                googleMapsWindow.src = src;
                $(modal).fadeIn(1000);
            }
            closeMapButton.onclick = function () {
                $(modal).fadeOut(1000);
            }
            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function (event) {
                if (event.target == modal) {
                    $(modal).fadeOut(1000);
                }
            }

            function initMap() {
                geocoder = new google.maps.Geocoder();
                map = new google.maps.Map(mapDiv, {
                    center: { lat: 32.069396, lng: 34.7869129 },
                    zoom: 13.5
                });
            }

            function setCurrentLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function (position) {
                        var pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        myCurrentLocation = new google.maps.LatLng(pos.lat, pos.lng);
                        service = new google.maps.DistanceMatrixService();
                        setDistancesFromCurrentLocation(allEvents);
                    }, function (error) {
                        if (error.message == "User denied Geolocation") {
                            createEvents(allEvents);
                        }
                    });

                }
            }
            function setDistancesFromCurrentLocation(allEvents) {
                var counter = 0;
                var numberOfEvents = allEvents.length;
                allEvents.forEach(event => {
                    var address = event.location.address;
                    if (address != "") {
                        var destination = new google.maps.LatLng(event.location.latitude, event.location.longtitude);
                        service.getDistanceMatrix(
                            {
                                origins: [myCurrentLocation],
                                destinations: [destination],
                                travelMode: 'WALKING',
                            }, function (response, status) {
                                if (status == google.maps.GeocoderStatus.OVER_QUERY_LIMIT) {
                                    console.log("OVER_QUERY_LIMIT");
                                    //There is a limit of 40 calls
                                }
                                else if (status == google.maps.GeocoderStatus.OK && response.rows[0].elements[0].status != "ZERO_RESULTS") {
                                    try {
                                        var distance = response.rows[0].elements[0].distance.text;
                                        event.location.distance = distance;
                                    }
                                    catch (err) {
                                        console.log("error " + err + ". Event guid : " + event.guid);
                                    }
                                }
                                else {
                                    console.log("Error while trying to get distance. " + status + ". Event guid : " + event.guid);
                                }
                                counter++;
                                if (counter == numberOfEvents) {
                                    createEvents(allEvents);
                                }
                            });
                    }
                    else {
                        counter++;
                        if (counter == numberOfEvents) {
                            createEvents(allEvents);
                        }
                    }
                });
            }
            function addMarkers() {
                filteredEvents.forEach(event => {
                    if (event.location.address != "") {
                        addMarker(event);
                    }
                });
            }
            var addMarker = function (event) {
                //geocoder.geocode({ 'address': event.address }, function (results, status) {
                //if (status == 'OK') {
                var marker = new google.maps.Marker({
                    map: map,
                    position: new google.maps.LatLng(event.location.latitude, event.location.longtitude),
                    title: event.title,
                    icon: 'images/pin.png',
                    animation: google.maps.Animation.DROP,
                    draggable: false,
                    event: event
                });

                google.maps.event.addListener(marker, 'click', function () {
                    var event = marker.event;

                    var sectionGroup = document.createElement("div");
                    sectionGroup.setAttribute("calss", "section group");

                    var eventCard = document.createElement("div");
                    eventCard.setAttribute("class", "col_1_of_3");
                    eventCard.setAttribute("style", "background:white");
                    var div = document.createElement("div");
                    div.setAttribute("class", "eventGUID");
                    div.innerHTML = event.guid;
                    eventCard.appendChild(div);
                    var img = document.createElement("img");
                    img.src = event.banner_uri;
                    var a = document.createElement("a");
                    a.href = event.link_value;
                    a.target = "_blank";
                    a.setAttribute("rel", "no-refresh");
                    a.appendChild(img)
                    eventCard.appendChild(a);

                    if (event.label != 0) {
                        var ul = document.createElement("ul");
                        ul.setAttribute("class", "m_fb");
                        var li = document.createElement("li");

                        var span = document.createElement("span");
                        span.setAttribute("class", "m_23");
                        var i = document.createElement("i");
                        var img = document.createElement("img");
                        img.width = "30";
                        i.appendChild(img);
                        span.appendChild(i);
                        li.appendChild(span);
                        if (event.label == 1) {
                            img.src = "images/food.png";
                        }
                        else if (event.label == 2) {
                            img.src = "images/hq.png";
                        }
                        else if (event.label == 3) {
                            img.src = "images/hq.png";
                            li.appendChild(span);

                            span = document.createElement("span");
                            span.setAttribute("class", "m_23");
                            i = document.createElement("i");
                            img = document.createElement("img");
                            img.src = "images/food.png";
                            img.width = "30";
                            i.appendChild(img);
                            span.appendChild(i);
                            li.appendChild(span);
                        }
                        else if (event.label == 4) {
                            img.src = "images/ic_90_percent_discount.png";
                        }
                        else if (event.label == 10) {
                            img.src = "images/hq.png";
                            li.appendChild(span);

                            span = document.createElement("span");
                            span.setAttribute("class", "m_23");
                            i = document.createElement("i");
                            img = document.createElement("img");
                            img.src = "images/ic_editors_choice.png";
                            img.width = "30";
                            i.appendChild(img);
                            span.appendChild(i);
                            li.appendChild(span);
                        }
                        else if (event.label == 11) {
                            img.src = "images/ic_editors_choice.png";
                        }
                        span = document.createElement("span");
                        span.setAttribute("class", "m_22 favorite");
                        var div = document.createElement("div");
                        if (favoritesEventsGUIDs.indexOf(event.guid) > -1) {
                            div.setAttribute("class", "star glyphicon glyphicon-star");
                        }
                        else {
                            div.setAttribute("class", "star glyphicon glyphicon-star-empty");
                        }
                        span.appendChild(div);
                        li.appendChild(span);
                        ul.appendChild(li);
                        eventCard.appendChild(ul);
                    }
                    var desc = document.createElement("div");
                    desc.setAttribute("class", "desc");
                    var h3 = document.createElement("h3");
                    a = document.createElement("a");
                    a.href = event.link_value;
                    a.target = "_blank";
                    a.setAttribute("rel", "no-refresh");
                    a.innerHTML = event.title;
                    var p = document.createElement("p");
                    p.innerHTML = event.message_text;
                    h3.appendChild(a);
                    var h4 = document.createElement("h4");
                    h4.setAttribute("class", "m_2");
                    h4.innerHTML = event.date;
                    desc.appendChild(h4);
                    desc.appendChild(h3);
                    desc.appendChild(p);
                    if (event.location.distance != "") {
                        p = p = document.createElement("p");
                        p.innerHTML = event.location.distance;
                        desc.appendChild(p);
                    }
                    eventCard.appendChild(desc);

                    var hr = document.createElement("hr");
                    hr.setAttribute("class", "hr");
                    eventCard.appendChild(hr);
                    div = document.createElement("div");
                    div.setAttribute("class", "section group center");
                    div.setAttribute("style", "padding: 0% 0% 2% 3%");
                    var label = document.createElement("label");
                    label.setAttribute("class", "btn myBtn popup");
                    label.setAttribute("style", "margin-right: 10px");
                    label.setAttribute("onclick", "openSharePopup(this.children[1])");
                    img = document.createElement("img");
                    img.src = "images/share.png";
                    img.setAttribute("class", "img-thumbnail");
                    img.setAttribute("style", "border:0;opacity: 0.5");
                    span = document.createElement("span");
                    span.setAttribute("class", "popuptext");
                    a = document.createElement("a");
                    a.setAttribute("class", "fa fa-twitter");
                    a.setAttribute("href", "https://twitter.com/intent/tweet?text=" + event.title + " : " + event.link_value);
                    a.setAttribute("target", "_blank");
                    a.setAttribute("rel", "no-refresh");
                    span.appendChild(a);
                    a = document.createElement("a");
                    a.setAttribute("class", "fa fa-facebook");
                    a.setAttribute("href", "https://www.facebook.com/sharer/sharer.php?u=" + event.link_value);
                    a.setAttribute("target", "_blank");
                    a.setAttribute("rel", "no-refresh");
                    span.appendChild(a);
                    a = document.createElement("a");
                    a.setAttribute("class", "fa fa-whatsapp");
                    a.setAttribute("href", "https://api.whatsapp.com/send?text=" + event.link_value);
                    a.setAttribute("target", "_blank");
                    a.setAttribute("rel", "no-refresh");
                    span.appendChild(a);
                    label.appendChild(img);
                    label.appendChild(span);
                    div.appendChild(label);
                    if (event.location.address != "") {
                        label = document.createElement("label");
                        label.setAttribute("class", "btn myBtn");
                        label.setAttribute("style", "margin-right: 10px");
                        label.setAttribute("onclick", "showMap('" + event.location.address + "');return false;");
                        label.setAttribute("title", event.location.address);
                        img = document.createElement("img");
                        img.src = "images/map.png";
                        img.setAttribute("class", "img-thumbnail");
                        img.setAttribute("style", "border:0;opacity: 0.5;");
                        label.appendChild(img);
                        div.appendChild(label);
                    }
                    eventCard.appendChild(div);

                    sectionGroup.appendChild(eventCard);

                    var div = document.getElementById("selectedPinEvent");
                    div.innerHTML = "";
                    div.appendChild(sectionGroup);
                    favoriteClicked();

                    $('html, body').animate({
                        scrollTop: $("#selectedPinEvent").offset().top
                    }, 500);
                });
                markers.push(marker);
                //}
                /*else if (status === google.maps.GeocoderStatus.OVER_QUERY_LIMIT) {
                    timeouts.push(setTimeout(function () {
                        addMarker(event);
                    }, 1000));
                    console.log("OVER_QUERY_LIMIT");
                }
                else {
                    console.log("Geocode was not successful for the following reason: " + status);
                }*/
                //});
            }
            function clearTimeouts() {
                for (var i = 0; i < timeouts.length; i++) {
                    clearTimeout(timeouts[i]);
                }
                timeouts = [];
            }
            function removeMarkers() {
                //Loop through all the markers and remove
                for (var i = 0; i < markers.length; i++) {
                    markers[i].setMap(null);
                }
                markers = [];
            };
            $(function () {
                $('li').click(function () {
                    $('li.active').removeClass('active');
                    $(this).addClass('active');
                });
            });
            $("#searchclear").click(function () {
                $("#searchinput").val('');
                filterChanged();
                ga('send', {
                    hitType: 'event',
                    eventCategory: 'Click',
                    eventAction: 'clear'//,
                    //eventLabel: 'cats.mp4'
                });
            });
            //Google analytics

            window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) }; ga.l = +new Date;
            ga('create', 'UA-120811908-1', 'auto');
            ga('send', 'pageview');

            $('.img-check').on('click', function () {
                var imgClicked = $(this);
                var id = imgClicked.attr('id');
                //check
                if (imgClicked.css('opacity') == '0.5') {
                    if (id == "chkHQ") {
                        hqFilterChecked = true;
                    }
                    else if (id == "chkFood") {
                        foodFilterChecked = true;
                    }
                    else if (id == "chk90") {
                        filter90Checked = true;
                    }
                    else if (id == "chkEditorChoice") {
                        editorChoiceFilterChecked = true;
                    }
                    if (id == "chkAll") {
                        allFilterChecked = true;

                        hqFilterChecked = false;
                        foodFilterChecked = false;
                        filter90Checked = false;
                        editorChoiceFilterChecked = false;

                        $('.img-check').css({
                            'opacity': '0.5',
                            'border-color': '#ddd'
                        });
                    }
                    else {
                        $('#chkAll').css({
                            'opacity': '0.5',
                            'border-color': '#ddd'
                        });
                        allFilterChecked = false;
                    }
                    imgClicked.css({
                        'opacity': '1',
                        'border-color': 'black'
                    });
                }
                //uncheck
                else {
                    imgClicked.css({
                        'opacity': '0.5',
                        'border-color': '#ddd'
                    });
                    if (id == "chkHQ") {
                        hqFilterChecked = false;
                    }
                    else if (id == "chkFood") {
                        foodFilterChecked = false;
                    }
                    else if (id == "chk90") {
                        filter90Checked = false;
                    }
                    else if (id == "chkEditorChoice") {
                        editorChoiceFilterChecked = false;
                    }
                    else if (id == "chkAll") {
                        allFilterChecked = false;
                    }
                }
                filterChanged();
            });
            $(window).resize(function () {
                setDisplayMode();
            });

            // When the user clicks on div, open the popup
            function openSharePopup(sharePopup) {
                sharePopup.classList.toggle("show");
            }
            function setDisplayMode() {
                // Get the snackbar DIV
                var snackbar = document.getElementById("snackbar");
                var formGroup = document.getElementsByClassName('form-group row')[0];
                if ($(window).width() < 500) {
                    if (mode == "desktop") {
                        mode = "mobile";
                        var panelBody = document.getElementsByClassName('panel-body')[0];
                        panelBody.appendChild(formGroup);
                        $('#accordion').css("display", "block");

                        var showGooglePlayPopup = localStorage.getItem("showGooglePlayPopup");
                        if (showGooglePlayPopup == null) {
                            // Add the "show" class to DIV
                            snackbar.className = "show";
                        }
                        else {
                            //Remove the "show class from DIV and add hide class
                            googlePlayCloseButtonClicked($(".closeGooglePlay")[0]);
                        }

                    }
                }
                else {
                    if (mode == "mobile") {
                        mode = "desktop";
                        var contentBox = document.getElementsByClassName('content-box-right')[0];
                        contentBox.appendChild(formGroup);
                        $('#accordion').css("display", "none");
                        snackbar.className = "hide";
                    }
                }
            }
            function googlePlayCloseButtonClicked(closeButton) {
                closeButton.parentNode.classList.remove('show');
                closeButton.parentNode.classList.add('hide');
                localStorage.setItem("showGooglePlayPopup", false);
            }
            //<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNlYlXjmjgDGoxeBxtWWUQYhxFGOyjCeo&sensor=false&language=he&libraries=visualization,places">
        </script>


        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdZD0Rsf1mCKYSh1Xu9I1d3uNIZM2hNEo&libraries=places&callback=initMap"
            type="text/javascript"></script>
        <script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>